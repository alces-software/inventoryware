#!/bin/bash

<% cmd_base="flight fact set #{@asset_data.name}" %>

# General System Information
<%= cmd_base %> 'Model' '<%= @asset_data.lshw.list.node.product %>'
<%= cmd_base %> 'BIOS_Version' '<%= find_hashes_with_key_value(@asset_hash, 'id', 'firmware')&.first['version'] %>'
<%= cmd_base %> 'Serial_Number' '<%= @asset_data.lshw.list.node.serial %>'

# CPUs
<% cpus.each do |cpu| %>
<%= cmd_base %> '<%= cpu.id.upcase %>_Model' '<%= cpu.model %>'
<%= cmd_base %> '<%= cpu.id.upcase %>_Slot' '<%= cpu.slot %>'
<% end %>

# Memory
<%= cmd_base %> 'Total_Memory' '<%= format_bytes_value(find_total_memory) %>'

# Network Devices
<% network_devices.each do |net| %>
<%= cmd_base %> '<%= net.logicalname %>_Product' '<%= net.product %> (<%= net.vendor %>)'
<% if net.speed == '0 bit/s' and net.logicalname.match? /ib/  %>
<%= cmd_base %> '<%= net.logicalname %>_Speed' 'Infiniband'
<% elsif net.speed == '0 bit/s' %>
<%= cmd_base %> '<%= net.logicalname %>_Speed' 'Virtual'
<% else %>
<%= cmd_base %> '<%= net.logicalname %>_Speed' '<%= net.speed %>'
<% end %>
<%= cmd_base %> '<%= net.logicalname %>_MAC' '<%= net.serial %>'
<% end %>

# Storage Devices
<% @asset_data.lsblk.disk&.each_pair do |disk, values| %>
<%= cmd_base %> '<%= disk %>_Size' '<%= values['SIZE'] %>'
<% end %>
